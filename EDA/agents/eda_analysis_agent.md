# EDA Analysis Agent

## Overview
The EDA Analysis Agent is responsible for testing individual hypotheses by fetching data using ETL schemas, performing correlation analysis, and creating visualizations. It executes the core analytical work for each hypothesis generated by the Hypothesis Generation Agent.

## Agent Specification

### Purpose
- Test individual hypotheses with statistical analysis
- Fetch data for target and using Intugle's DataProductBuilder and ETL schemas
- Perform correlation analysis and statistical tests
- Generate visualizations to illustrate relationships
- Provide detailed analysis results for each hypothesis

### Input Requirements
- **Individual Hypothesis**: Single hypothesis from Hypothesis Generation Agent:
Hypothesis is in this format (key - value dictionary):
1. HYPOTHESIS: Marketing spend increases lead to higher revenue during peak seasons
   ID: hyp_1
   Confidence: 0.85
   Test Priority: 0.90
   Relationship Type: log_log_relationship
   Expected Impact: positive
   Target Variable: revenue
     - Transformation: none
     - Aggregate By: monthly
   Predictor Variable: marketing_spend
     - Transformation: log_log
     - Aggregate By: monthly
   Research Support:
     - Industry research shows marketing ROI correlation
     - Seasonal pattern analysis
   Interaction Features: seasonal_effect
   Data Requirements:
     - Tables: revenue, marketing
     - Columns: revenue.amount, marketing.spend
     - Join: time_based_join    

- **Target Variable**: The variable being predicted

### Tools:
1. Intugle Tools: Load Intugle tools from tools folder. Use reference of univariate_analysis agent for this purpose, there are tools to create ETL schema and execute ETL using DataProductBuilder
2. Transformation tool: Based on hypothesis, specific transformations to be applied to target variable and influencing variable. Transformation types can be referered from hypothesis_generationagent
3. Correlation Analysis tool: To perform correlation analysis on the transformed data between target annd influencing variables
4. Visualization tool: To plot and save the visualization between transformed variables

The base functions for tools need to be present in the tools folder. Strictly avoid repeated nesting of functionss


### Agent Behavior
#### 1. Initialization
- Load hypothesis and configuration parameters
- Initialize data fetching and analysis tools
- Set up visualization preferences
- Configure timeout and error handling


Dynamic Behavior (to be covered through prompts + tool calling)
#### 2. Data Fetching
- Build ETL schema based on hypothesis requirements
- Use DataProductBuilder to fetch required data
- Validate data quality and completeness
- Handle data access errors gracefully

#### 3. Statistical Analysis
- Apply specified transformations to variables
- Perform multiple correlation tests
- Calculate statistical significance
- Generate comprehensive statistical summary

#### 4. Visualization Generation
- Create scatter plots with trend lines
- Generate correlation heatmaps
- Produce distribution plots
- Create specialized plots based on data types

#### 5. Results Compilation
- Evaluate hypothesis support based on evidence
- Generate feature engineering recommendations
- Compile key findings and insights
- Format results for downstream processing

### Error Handling
- Handle data fetching failures with detailed error messages
- Manage insufficient data scenarios
- Handle statistical analysis errors
- Provide fallback options for visualization failures

### Performance Considerations
- Optimize data fetching with efficient ETL queries
- Use sampling for large datasets when appropriate
- Cache visualization results
- Implement timeout handling for long-running analyses

### Integration Points
- **Input**: Receives individual hypothesis from EDA Worker Loop Agent
- **Output**: Provides detailed analysis results to EDA Worker Loop Agent
- **Tools**: Integrates with Intugle DataProductBuilder and visualization tools
- **State**: Updates workflow state with analysis progress

### Example Usage
```python
# Initialize EDA Analysis Agent
eda_agent = EDAAnalysisAgent(
    hypothesis=hypothesis,
    kb=knowledge_builder,
    target_variable="sales_revenue",
    timeout=300
)

# Execute analysis
results = await eda_agent.analyze_hypothesis()

# Access results
correlation_score = results["correlation_analysis"]["correlations"]["pearson"]["correlation"]
visualizations = results["visualizations"]
recommendations = results["feature_engineering_insights"]["engineering_recommendations"]
```

### Success Criteria
- Successfully fetch data for hypothesis testing
- Perform comprehensive statistical analysis
- Generate meaningful visualizations
- Provide actionable feature engineering recommendations
- Complete analysis within specified timeout limits
